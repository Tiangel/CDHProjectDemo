package com.cloudera.flume.utils;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;import java.util.HashMap;import java.util.Map;import java.util.regex.Matcher;import java.util.regex.Pattern;public class JsonStr2Map {    public static Map<String, String> jsonStr2Map(String jsonStr) {        Map<String, String> resultMap = new HashMap<>();        Pattern pattern = Pattern.compile("(\"\\w+\"):(\"[^\"]+\")");        Matcher m = pattern.matcher(jsonStr);        String[] strs = null;        while (m.find()) {            strs = m.group().split(":");            if (strs != null && strs.length == 2) {                resultMap.put(strs[0].replaceAll("\"", "").trim(), strs[1].trim().replaceAll("\"", ""));            }        }        return resultMap;    }    public static void main(String[] args) {        String jsonStr = "{\"$time\":1589512944083,\"$properties\":{\"$browser_version\":\"11.22.9.10\",\"$os\":\"Android\",\"$is_first_time\":true,\"$network_type\":\"CELLULAR\",\"$wifi\":false,\"$ip\":\"49.94.141.179\",\"$screen_height\":780,\"$user_agent\":\"mozilla/5.0 (linux; android 9; ask-al00x build/honorask-al00x; wv) applewebkit/537.36 (khtml, like gecko) version/4.0 chrome/76.0.3809.89 mobile safari/537.36 t7/11.22 light/1.0 sp-engine/2.18.0 baiduboxapp/11.22.9.10 (baidu; p1 9)\",\"$referrer\":\"\",\"$user_id\":\"\",\"$address\":{\"addrDetail\":\"江苏省南京市\",\"city\":\"南京市\",\"country\":\"中国\",\"county\":\"\",\"isp\":\"电信\",\"province\":\"江苏省\"},\"$custom_properties\":{},\"$url_path\":\"/page\",\"$province\":\"江苏省\",\"$url\":\"https://appd.evergrande.com/makePost_pro/index.html#/page?jsUrl=hftzxj0229&channel=9489\",\"$platform_type\":\"H5\",\"$os_version\":\"9\",\"$is_first_day\":true,\"$referrer_host\":\"\",\"$city\":\"南京市\",\"$model\":\"ask-al00x\",\"$screen_width\":360,\"$browser\":\"百度极速版\",\"$lib\":\"javascript\",\"$title\":\"广告详情\",\"$lib_version\":\"v1.0.0\",\"$source_platform\":4,\"$manufacturer\":\"华为\"},\"$event\":\"$Pageview\",\"$device_id\":\"1589512943006|780|360|TW96aWxsYS81LjAoTGludXg7QW5kcm9pZDk|L3jRZe3GyvfVy2v\",\"$type\":\"track\",\"$project\":\"eda_project_98\"}";        String sourceKeys = "$project,$time,$device_id,$properties.$platform_type,$properties.$os,$type,$event,$properties.$user_id,$properties.$url,$properties.$is_first_time,$properties.$element_id,$properties.$element_type,$properties.$element_content,$properties.$element_position,$properties.$custom_properties.target_product_id,$properties.$custom_properties.target_type,$properties.$custom_properties.target_level";        String targetKeys = "project,time,device_id,platform_type,os,type,event,user_id,viewUrl,is_first_time,element_id,element_type,element_content,element_position,target_product_id,target_type,target_level";        String[] sourceArray = sourceKeys.split(",", -1);        String[] targetArray = targetKeys.split(",", -1);        Map resultMap = new HashMap<String, String>();        String[] array = null;        if (sourceArray.length == targetArray.length) {            JSONObject jsonObject = JSONObject.parseObject(jsonStr);            JSONObject jsonObjectTemp = null;            for (int i = 0; i < sourceArray.length; i++) {                if (sourceArray[i].contains(".")) {                    array = sourceArray[i].split("\\.", -1);                    jsonObjectTemp = jsonObject;                    for (int j = 0; j < array.length - 1; j++) {                        if (jsonObjectTemp != null) {                            jsonObjectTemp = jsonObjectTemp.getJSONObject(array[j]);                        }else {                            break;                        }                    }                    if (jsonObjectTemp != null){                        resultMap.put(targetArray[i].trim().toLowerCase(), String.valueOf(jsonObjectTemp.getOrDefault(array[array.length - 1], "")));                    }else {                        resultMap.put(targetArray[i], "");                    }                } else {                    resultMap.put(targetArray[i].trim().toLowerCase(), String.valueOf(jsonObject.getOrDefault(sourceArray[i], "")));                }            }        } else {            System.out.println("The sourceKeys and targetkeys lengths do not match");        }        System.out.println(JSON.toJSONString(resultMap));        Map<String, String> rawMap = JSON.parseObject(JSON.toJSONString(resultMap), HashMap.class);        System.out.println(rawMap);    }}